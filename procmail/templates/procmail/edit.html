{% extends "procmail/base.html" %}
{% block content %}
<form action="" method="post">
  {% csrf_token %}
  <h2>Metadata</h2>
  <table class="table table-striped table-bordered">
    {{form_meta.as_table}}
  </table>
  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target=".advanced_params">
    Show Advanced parameters
  </button>
  {% if curr_stmt.is_recipe %}




    <h1>Recipe</h1>
    <h2>Header</h2>
    {{form_header.show_init}}
    {% if form_header.non_field_errors %}
      {{form_header.non_field_errors}}
    {% endif %}
    <table class="table table-striped table-bordered">
    {% for field in form_header %}
      <tr {% if not field.field.show %}class="collapse advanced_params"{% endif %}>
        <td>{{field.label_tag}}</td><td>{{ field.errors }} {{ field }} {{ field.help_text}}</td>
      </tr>
    {% endfor %}
    <table>

    <h2>Conditions</h2>
    {{ form_condition.management_form }}
    {{form_condition.show_init}}
    {% if form_condition.non_form_errors %}
      {{form_condition.non_form_errors}}
    {% endif %}
    <table class="table table-striped table-bordered">
      <tr>
      {% for field in form_condition.0 %}
         <th {% if not field.field.show %}class="collapse advanced_params"{% endif %}>
           {{field.label}}
         </th>
      {% endfor %}
      </tr>
      {% for fcond in form_condition %}
        {% if fcond.non_field_errors %}
          <tr><td colspan="30">{{fcond.non_field_errors}}</td></tr>
        {% endif %}
        <tr>
        {% for field in fcond %}
          <td {% if not field.field.show %}class="collapse advanced_params"{% endif %}>
            {{field.errors}} {{field}}
          </td>
        {% endfor %}
        </tr>
      {% endfor %}
    </table>

    <h2>Action<h2>
    {{form_action.show_init}}
    {% if form_action.non_field_errors %}
      {{form_action.non_field_errors}}
    {% endif %}
    <table class="table table-striped table-bordered">
      <tr>
        <td style="white-space: nowrap;">{{form_action.action_type.label_tag}}</td><td style="width:100%">{{ form_action.action_type.errors }} {{ form_action.action_type }} {{ form_action.action_type.help_text}}</td>
      </tr>
      <tr id="action_param">
        <td>{{form_action.action_param.label_tag}}</td><td>{{ form_action.action_param.errors }} {{ form_action.action_param }} {{ form_action.action_param.help_text}}</td>
      </tr>
      {% if curr_stmt.action.is_nested %}
      {% for stmt in curr_stmt %}
      <tr><td colspan="2"><a href="{% url "procmail:edit" stmt.id %}">{% if stmt.meta_title %}{{stmt.meta_title}}{% else %}{{stmt.gen_title}}{% endif %}</a></td></tr>
      {% endfor %}
      {% endif %}
      <tr id="action_nested">
       <td colspan="2" style="text-align:center"><input type="submit" name="action_add" value="Add action" class="btn btn-primary btn-lg  btn-block"/></td>
      </tr>
    <table>
<script>
var hide_param = function() {
 var value = $('#id_action-action_type').val();
 if(value == "nested"){
   $('#action_param').hide();
   $('#action_nested').show();
 } else {
   $('#action_param').show();
   $('#action_nested').hide();
 }
};

$('#id_action-action_type').change(hide_param);
$('#id_action-action_type').ready(hide_param);
</script>
  {% elif curr_stmt.is_assignment %}

    {{ form_assignment.management_form }}
    <h2>Assignement</h2>
    {% if form_assignment.non_form_errors %}
      {{form_assignment.non_form_errors}}
    {% endif %}
    <table class="table table-striped table-bordered">
      <tr><th>{{form_assignment.0.variable_name.label}}</th><th>{{form_assignment.0.value.label}}</th><th>{{form_assignment.0.DELETE.label}}</th></tr>
      {% for form in form_assignment %}
        {% if form.non_field_errors %}
          <tr><td colspan="3">{{form.non_field_errors}}</td></tr>
        {% endif %}
        <tr><td>{{form.variable_name}} {{form.variable_name.errors}}</td><td>{{form.value}} {{form.value.errors}}</td><td>{% if form.variable_name.value %}{{form.DELETE}}{% endif %}</td></tr>
      {% endfor %}
    </table>
  {% endif %}

  <input type="submit" value="Submit" class="btn btn-primary"/>
  <input type="submit" value="Delete" name="delete_stmt" class="btn btn-danger" style="float:right"/>
</form>

<h2>Preview</h2>
<pre>
  {{curr_stmt.render}}
</pre>
{% endblock %}
